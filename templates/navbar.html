<!-- Urgency Banner -->
<div id="urgency-banner" 
     style="background:#ff4c4c; color:#fff; font-weight:700; font-size:16px; text-align:center; padding:12px; position:sticky; top:0; z-index:999; letter-spacing:0.5px; border-bottom:2px solid #f5d76e;">
  üî• Deal Ending Soon! Don‚Äôt Miss Out!
  <span id="countdown" style="display:none;"></span>
</div>

<!-- Admin Controls -->
{% if current_user.is_authenticated and current_user.is_admin %}
<div style="text-align:center; margin:10px 0;">
  <input type="number" id="customMinutes" placeholder="Minutes" min="1" style="width:100px;"/>
  <button id="startCountdownBtn" class="btn btn-warning btn-sm">Start Countdown</button>
  <form action="{{ url_for('stop_countdown') }}" method="post" style="display:inline;">
    <button type="submit" class="btn btn-danger btn-sm">Stop Countdown</button>
  </form>
</div>
{% endif %}

<script>
function startCountdown(elementId, duration) {
  const el = document.getElementById(elementId);
  const banner = document.getElementById("urgency-banner");
  if (!el || !banner) return;

  let remaining = duration;
  el.style.display = "inline"; // show countdown
  banner.innerHTML = `‚è≥ Exclusive Deal! Ends in <span id="countdown"></span> ‚Äì Enjoy <strong style="color:#ffffff;">5% OFF + Free Delivery</strong>`;

  const countdownSpan = document.getElementById("countdown");

  function render() {
    if (remaining <= 0) {
      countdownSpan.textContent = "00:00:00";
      banner.innerHTML = "üî• Deal Ending Soon! Don‚Äôt Miss Out!";
      banner.style.background = "#ff4c4c";
      banner.style.color = "#fff";
      banner.style.fontSize = "18px";
      banner.style.fontWeight = "700";
      clearInterval(window.countdownInterval);
      return;
    }

    let hours = Math.floor((remaining / 3600) % 24);
    let minutes = Math.floor((remaining / 60) % 60);
    let seconds = Math.floor(remaining % 60);

    countdownSpan.textContent =
      (hours < 10 ? "0" + hours : hours) + ":" +
      (minutes < 10 ? "0" + minutes : minutes) + ":" +
      (seconds < 10 ? "0" + seconds : seconds);

    remaining--;
  }

  clearInterval(window.countdownInterval);
  window.countdownInterval = setInterval(render, 1000);
  render();
}

// Admin Start Button
const startBtn = document.getElementById("startCountdownBtn");
if (startBtn) {
  startBtn.addEventListener("click", async () => {
    const minutes = parseInt(document.getElementById("customMinutes").value);
    if (!minutes || minutes <= 0) return alert("Enter a valid number of minutes.");

    // Send request to backend
    const res = await fetch("/start_countdown_custom", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ minutes })
    });

    if (res.ok) {
      startCountdown("countdown", minutes * 60);
    } else {
      const msg = await res.text();
      alert("Error: " + msg);
    }
  });
}
</script>

<nav class="custom-navbar navbar navbar-expand-md" aria-label="GSpaces Navigation Bar">
    <div class="container">
        <a class="navbar-brand" href="{{ url_for('index') }}">
            <img src="{{ url_for('static', filename='img/gspaces-logo.png') }}" alt="GSPACES-LOGO">
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsFurni" aria-controls="navbarsFurni" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarsFurni">
            <ul class="custom-navbar-nav navbar-nav ms-auto mb-2 mb-md-0">
                <li class="nav-item {% if request.endpoint == 'index' %}active{% endif %}">
                    <a class="nav-link" href="{{ url_for('index') }}#hero">Home</a>
                </li>
                <li class="nav-item"><a class="nav-link" href="{{ url_for('index') }}#about">About</a></li>
                <li class="nav-item"><a class="nav-link" href="{{ url_for('index') }}#services">Services</a></li>
                <li class="nav-item"><a class="nav-link" href="{{ url_for('index') }}#products">Products</a></li>
                <li class="nav-item"><a class="nav-link" href="{{ url_for('index') }}#team">Team</a></li>
                <li class="nav-item"><a class="nav-link" href="{{ url_for('index') }}#contact">Contact</a></li>
            </ul>
            <ul class="custom-navbar-cta navbar-nav mb-2 mb-md-0 ms-5">
                <li>
                    <a class="nav-link" href="{{ url_for('cart') }}">
                        <img src="{{ url_for('static', filename='img/desks.svg') }}" alt="Cart">
                        {% if cart_count > 0 %}
                            <span class="badge bg-primary rounded-pill">{{ cart_count }}</span>
                        {% endif %}
                    </a>
                </li>
                <li>
                    <a class="nav-link" href="{{ url_for('profile') }}">
                        <img src="{{ url_for('static', filename='img/user.svg') }}" alt="User">
                    </a>
                </li>
            </ul>
        </div>
    </div>
</nav>
<i class="mobile-nav-toggle"></i>
